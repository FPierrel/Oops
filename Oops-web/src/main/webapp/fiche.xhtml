<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <f:metadata>
        <f:viewParam name="page" value="#{ficheBean.page}" />
        <f:viewAction action="#{ficheBean.init}" />
    </f:metadata>
    <h:head>
        <title>Oops | #{ficheBean.prestataire.nomEntreprise}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link href='https://fonts.googleapis.com/css?family=Kavoon' rel='stylesheet' type='text/css'/>
        <link href="style/style2.css" rel="stylesheet" type="text/css" />
    </h:head>
    <h:body>
        <ui:include src="header.xhtml"/>
        <ui:include src="search.xhtml"/>
        <div id="featured-wrapper">
            <div id ="content">
                <div id="featured" class="container">
                    <p:messages />
                    <div class="prestataire">
                        <h1><h:outputText id="companyName" value="#{ficheBean.prestataire.nomEntreprise}"/></h1>
                        <h:form><p:rating value="#{ficheBean.noteTotal}" readonly="true"/></h:form>
                        <div id="rating"><a href="#avis">#{ficheBean.nbAvis} avis</a></div><br/><br/>
                        <h:outputText id="description" value="#{ficheBean.prestataire.description}" /><br/><br/>

                        <h2>Informations : </h2><br/>
                        <h3>Catégories</h3>
                        <span id="categories">
                            <ui:repeat value="#{ficheBean.categories}" var="categorie">
                                <h:outputText value="#{categorie}"/><br/>
                            </ui:repeat>
                        </span>
                        <h3>Contacts : </h3>
                        <h:outputText value="Représentant : #{ficheBean.prestataire.prenom} #{ficheBean.prestataire.nom}" /><br/>
                        <h:dataTable value="#{ficheBean.prestataire.adresses}" var="address">
                            <h:column>
                                <h:outputText value="#{address.numero}, "/>                  
                            </h:column>
                            <h:column>
                                <h:outputText value="#{address.rue}"/>             
                            </h:column>
                            <h:column>
                                <h:outputText value="#{address.complement}"/>                  
                            </h:column>
                            <h:column>
                                <h:outputText value="#{address.codePostal}"/>                  
                            </h:column>
                            <h:column>
                                <h:outputText value="#{address.ville}, "/>                  
                            </h:column>
                        </h:dataTable>
                        <h:outputText value="Téléphone : #{ficheBean.prestataire.numeroTelephone} " />
                        <h:outputText value="E-mail : #{ficheBean.prestataire.mail} " />
                        <h:outputText id="website" value="Site Web : #{ficheBean.prestataire.siteWeb} " />
                        <h3>A propos de :</h3>
                        <h:outputText value="Raison sociale : A DEFINIR ! " /><br/>
                        <h:outputText value="Forme juridique : A DEFINIR ! " /><br/>
                        <h:outputText id="employeeNumber" value="Nombre d'employé(s) : #{ficheBean.prestataire.nbEmployes} " /><br/>
                        <h:outputText id="turnover" value="Chiffre d'affaire : #{ficheBean.prestataire.chiffreAffaire} € " /><br/><br/><br/>
                        <h2>Evaluation : </h2><br/>
                        <h:form>
                            <h:outputText value="Communication : "/><p:rating value="#{ficheBean.noteGlobCom}" readonly="true"/><br/><br/>
                            <h:outputText value="Qualité : "/><p:rating value="#{ficheBean.noteGlobQualite}" readonly="true"/><br/><br/>
                            <h:outputText value="Prix : "/><p:rating value="#{ficheBean.noteGlobPrix}" readonly="true"/><br/><br/>
                            <h:outputText value="Délai : "/><p:rating value="#{ficheBean.noteGlobDelai}" readonly="true"/><br/><br/><br/><br/>
                        </h:form>
                        <div id="avis">
                            <h:form rendered="#{request.remoteUser != null}">
                                <h2>Donnez votre avis : </h2><br/>
                                <h:outputText value="Communication : "/>
                                <p:rating value="#{ficheBean.rate1}" stars="5" cancel="false" /><br/><br/>
                                <h:outputText value="Qualité : "/>
                                <p:rating value="#{ficheBean.rate2}" stars="5" cancel="false" /><br/><br/>
                                <h:outputText value="Prix : "/>
                                <p:rating value="#{ficheBean.rate3}" stars="5" cancel="false" /><br/><br/>
                                <h:outputText value="Délai : "/>
                                <p:rating value="#{ficheBean.rate4}" stars="5" cancel="false" /><br/><br/>
                                <h:outputText value="Laissez un commentaire sur la prestation : "/><br/><br/>
                                <p:inputText value="#{ficheBean.opinion}" id="opinion"/><br/><br/>
                                <p:commandButton class="button" value="Soumettre" action="#{ficheBean.saveOpinion()}" update="@all"/><br/><br/>                                
                            </h:form>
                            <h:panelGroup id="panelAvis">
                                <h2>Avis des clients: </h2>

                                <ul>
                                    <ui:repeat value="#{ficheBean.getlAvis()}" var="cAvis" varStatus="loop">

                                        <h:form id="lAvis#{loop.index}">
                                            <p:fieldset legend="Par #{cAvis.owner.login} le #{cAvis.pDate}" style="margin-bottom:20px">
                                                <h:panelGrid columns="4" cellpadding="5">                                                          
                                                    <h:outputText value="Communication : "/>
                                                    <h:outputText value="Qualité : "/>
                                                    <h:outputText value="Prix : "/>
                                                    <h:outputText value="Délai : "/>
                                                    <p:rating value="#{cAvis.noteCom}" stars="5" cancel="false" readonly="true"/>
                                                    <p:rating value="#{cAvis.noteQualite}" stars="5" cancel="false" readonly="true"/>
                                                    <p:rating value="#{cAvis.notePrix}" stars="5" cancel="false" readonly="true"/>
                                                    <p:rating value="#{cAvis.noteDelai}" stars="5" cancel="false" readonly="true"/>
                                                </h:panelGrid>



                                                <h:outputText value="Commentaire : "/><br/>
                                                <h:outputText value="#{cAvis.contenu}" /><br/><br/>  

                                                Réponses : <br/><br/>

                                                <ui:repeat value="#{cAvis.commentaires}" var="comm" varStatus="i">
                                                    <p:fieldset legend="Par #{comm.profil} le #{comm.comDate}" style="margin-bottom:20px">
                                                        <h:panelGrid columns="2" cellpadding="5">                                                          
                                                            <h:outputText value="#{comm.contenu}"/> 
                                                        </h:panelGrid>
                                                    </p:fieldset>               
                                                </ui:repeat>

                                                <h:panelGrid columns="2" cellpadding="5">
                                                    <input type="text" id="co#{loop.index}" name="co#{loop.index}" />
                                                    <p:commandButton value="Commenter cet avis" action="#{ficheBean.saveComment(loop.index)}" update="@all" />
                                                </h:panelGrid>

                                            </p:fieldset>
                                        </h:form>

                                    </ui:repeat>
                                </ul>

                            </h:panelGroup>
                        </div>
                    </div>    
                </div>
            </div>
        </div>
        <ui:include src="footer.xhtml"/>
    </h:body>
</html>
